{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { CollectionSlug, Config } from 'payload'\n\nexport { CommentFeature } from './features/commenting/feature.server.js'\nexport type { CommentFeatureProps } from './features/commenting/feature.server.js'\n\nexport type PayloadLexicalCollaborationConfig = {\n  /**\n   * List of collections to add a custom field\n   */\n  collections?: Partial<Record<CollectionSlug, true>>\n  disabled?: boolean\n  /**\n   * Slug of the user collection (e.g. 'editors'). Defaults to 'users'.\n   */\n  userCollectionSlug?: string\n}\n\nexport const payloadLexicalCollaboration =\n  (pluginOptions: PayloadLexicalCollaborationConfig) =>\n  (config: Config): Config => {\n    if (!config.collections) {\n      config.collections = []\n    }\n\n    // Add the comments collection\n    config.collections.push({\n      slug: 'lexical-collaboration-plugin-comments',\n      access: {\n        read: () => true,\n      },\n      admin: {\n        defaultColumns: ['content', 'author', 'createdAt'],\n        hidden: true,\n        useAsTitle: 'content',\n      },\n      fields: [\n        {\n          name: 'documentId',\n          type: 'text',\n          index: true,\n          required: true,\n        },\n        {\n          name: 'threadId',\n          type: 'text',\n          required: true,\n        },\n        {\n          name: 'content',\n          type: 'text',\n          required: true,\n        },\n        {\n          name: 'author',\n          type: 'relationship',\n          relationTo: pluginOptions.userCollectionSlug || 'users',\n          required: true,\n        },\n        {\n          name: 'quote',\n          type: 'text',\n        },\n        {\n          name: 'range',\n          type: 'json',\n        },\n        {\n          name: 'resolved',\n          type: 'checkbox',\n          defaultValue: false,\n        },\n        {\n          name: 'parentComment',\n          type: 'relationship',\n          relationTo: 'lexical-collaboration-plugin-comments',\n        }\n      ]\n    })\n\n\n    /**\n     * If the plugin is disabled, we still want to keep added collections/fields so the database schema is consistent which is important for migrations.\n     * \n     * NOTE: To properly disable this plugin while preserving existing comment marks in documents,\n     * it's recommended to use the `disabled: true` option here rather than commenting out the plugin entirely.\n     * This ensures the MarkNode is still registered to prevent \"parseEditorState: type 'mark' not found\" errors.\n     * \n     * Alternatively, you can keep the CommentFeature in your editor features with `enabled: false`:\n     * \n     * editor: lexicalEditor({\n     *   features: ({ defaultFeatures }) => [\n     *     ...defaultFeatures,\n     *     CommentFeature({ enabled: false }),\n     *   ],\n     * }),\n     */\n    if (pluginOptions.disabled) {\n      return config\n    }\n\n    if (!config.endpoints) {\n      config.endpoints = []\n    }\n\n    // Using Payload's built-in REST API for endpoints\n\n    if (!config.admin) {\n      config.admin = {}\n    }\n\n    if (!config.admin.components) {\n      config.admin.components = {}\n    }\n\n    if (!config.admin.components.beforeDashboard) {\n      config.admin.components.beforeDashboard = []\n    }\n\n\n    const incomingOnInit = config.onInit\n\n    config.onInit = async (payload) => {\n      // Ensure we are executing any existing onInit functions before running our own.\n      if (incomingOnInit) {\n        await incomingOnInit(payload)\n      }\n\n      // Plugin initialization complete\n    }\n\n    return config\n  }\n"],"names":["CommentFeature","payloadLexicalCollaboration","pluginOptions","config","collections","push","slug","access","read","admin","defaultColumns","hidden","useAsTitle","fields","name","type","index","required","relationTo","userCollectionSlug","defaultValue","disabled","endpoints","components","beforeDashboard","incomingOnInit","onInit","payload"],"mappings":"AAEA,SAASA,cAAc,QAAQ,0CAAyC;AAexE,OAAO,MAAMC,8BACX,CAACC,gBACD,CAACC;QACC,IAAI,CAACA,OAAOC,WAAW,EAAE;YACvBD,OAAOC,WAAW,GAAG,EAAE;QACzB;QAEA,8BAA8B;QAC9BD,OAAOC,WAAW,CAACC,IAAI,CAAC;YACtBC,MAAM;YACNC,QAAQ;gBACNC,MAAM,IAAM;YACd;YACAC,OAAO;gBACLC,gBAAgB;oBAAC;oBAAW;oBAAU;iBAAY;gBAClDC,QAAQ;gBACRC,YAAY;YACd;YACAC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;oBACNC,OAAO;oBACPC,UAAU;gBACZ;gBACA;oBACEH,MAAM;oBACNC,MAAM;oBACNE,UAAU;gBACZ;gBACA;oBACEH,MAAM;oBACNC,MAAM;oBACNE,UAAU;gBACZ;gBACA;oBACEH,MAAM;oBACNC,MAAM;oBACNG,YAAYhB,cAAciB,kBAAkB,IAAI;oBAChDF,UAAU;gBACZ;gBACA;oBACEH,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;oBACNK,cAAc;gBAChB;gBACA;oBACEN,MAAM;oBACNC,MAAM;oBACNG,YAAY;gBACd;aACD;QACH;QAGA;;;;;;;;;;;;;;;KAeC,GACD,IAAIhB,cAAcmB,QAAQ,EAAE;YAC1B,OAAOlB;QACT;QAEA,IAAI,CAACA,OAAOmB,SAAS,EAAE;YACrBnB,OAAOmB,SAAS,GAAG,EAAE;QACvB;QAEA,kDAAkD;QAElD,IAAI,CAACnB,OAAOM,KAAK,EAAE;YACjBN,OAAOM,KAAK,GAAG,CAAC;QAClB;QAEA,IAAI,CAACN,OAAOM,KAAK,CAACc,UAAU,EAAE;YAC5BpB,OAAOM,KAAK,CAACc,UAAU,GAAG,CAAC;QAC7B;QAEA,IAAI,CAACpB,OAAOM,KAAK,CAACc,UAAU,CAACC,eAAe,EAAE;YAC5CrB,OAAOM,KAAK,CAACc,UAAU,CAACC,eAAe,GAAG,EAAE;QAC9C;QAGA,MAAMC,iBAAiBtB,OAAOuB,MAAM;QAEpCvB,OAAOuB,MAAM,GAAG,OAAOC;YACrB,gFAAgF;YAChF,IAAIF,gBAAgB;gBAClB,MAAMA,eAAeE;YACvB;QAEA,iCAAiC;QACnC;QAEA,OAAOxB;IACT,EAAC"}
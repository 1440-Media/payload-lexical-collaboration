{"version":3,"sources":["../../../src/features/commenting/feature.client.tsx"],"sourcesContent":["'use client'\n\nimport { createClientFeature } from '@payloadcms/richtext-lexical/client'\nimport { MarkNode } from '@payloadcms/richtext-lexical/lexical/mark'\nimport { useAuth } from '@payloadcms/ui'\n\nimport type { CommentClientFeatureProps } from './types/props.js'\n\nimport { CommentPlugin } from './components/core/CommentPlugin.js'\nimport { CommentMarkStyles } from './components/ui/index.js'\nimport { getDocumentIdFromUrl } from './utils/url.js'\n\nexport const CommentClientFeature = createClientFeature<CommentClientFeatureProps>(\n  ({ props }) => {\n    const enabled = props?.enabled ?? true\n\n    if (!enabled) {\n      return {\n        // Always register MarkNode even when disabled to prevent errors with existing marks\n        nodes: [MarkNode],\n        plugins: [\n          {\n            Component: () => <CommentMarkStyles enabled={false} />,\n            position: 'normal',\n          },\n        ],\n        toolbarFixed: {\n          groups: [],\n        },\n        toolbarInline: {\n          groups: [],\n        },\n      }\n    }\n\n    return {\n      nodes: [MarkNode],\n      plugins: [\n        {\n          Component: () => {\n            const { user } = useAuth()\n            \n            // Get the document ID from the URL\n            const documentId = typeof window !== 'undefined' \n              ? getDocumentIdFromUrl()\n              : undefined\n            \n            // Get the current user's name or email\n            const currentUser = user?.email || 'Anonymous'\n\n            return (\n              <>\n                <CommentMarkStyles enabled={true} />\n                <CommentPlugin\n                  currentUser={currentUser}\n                  documentId={documentId}\n                  userCollectionSlug={props?.userCollectionSlug}\n                />\n              </>\n            )\n          },\n          position: 'normal',\n        },\n      ],\n      toolbarFixed: {\n        groups: [], // Commented out temporarily until toolbar buttons are fixed\n        /* groups: [\n          {\n            type: 'dropdown',\n            ChildComponent: CommentIcon,\n            key: 'commenting',\n            items: [\n              {\n                type: 'button',\n                label: 'Add Comment',\n                onClick: ({ editor }: { editor: any }) => {\n                  editor.dispatchCommand(INSERT_COMMENT_COMMAND, undefined)\n                },\n                key: 'addComment',\n              },\n              {\n                type: 'button',\n                label: 'Toggle Comments',\n                onClick: ({ editor }: { editor: any }) => {\n                  editor.dispatchCommand(TOGGLE_COMMENTS_COMMAND, undefined)\n                },\n                key: 'toggleComments',\n              },\n            ],\n          },\n        ], */\n      },\n      toolbarInline: {\n        groups: [], // Commented out temporarily until toolbar buttons are fixed\n        /* groups: [\n          {\n            type: 'dropdown',\n            ChildComponent: CommentIcon,\n            key: 'commenting-inline',\n            items: [\n              {\n                type: 'button',\n                label: 'Add Comment',\n                onClick: ({ editor }: { editor: any }) => {\n                  editor.dispatchCommand(INSERT_COMMENT_COMMAND, undefined)\n                },\n                key: 'addComment-inline',\n              },\n            ],\n          },\n        ], */\n      },\n    }\n  },\n)\n"],"names":["createClientFeature","MarkNode","useAuth","CommentPlugin","CommentMarkStyles","getDocumentIdFromUrl","CommentClientFeature","props","enabled","nodes","plugins","Component","position","toolbarFixed","groups","toolbarInline","user","documentId","window","undefined","currentUser","email","userCollectionSlug"],"mappings":"AAAA;;AAEA,SAASA,mBAAmB,QAAQ,sCAAqC;AACzE,SAASC,QAAQ,QAAQ,4CAA2C;AACpE,SAASC,OAAO,QAAQ,iBAAgB;AAIxC,SAASC,aAAa,QAAQ,qCAAoC;AAClE,SAASC,iBAAiB,QAAQ,2BAA0B;AAC5D,SAASC,oBAAoB,QAAQ,iBAAgB;AAErD,OAAO,MAAMC,uBAAuBN,oBAClC,CAAC,EAAEO,KAAK,EAAE;IACR,MAAMC,UAAUD,OAAOC,WAAW;IAElC,IAAI,CAACA,SAAS;QACZ,OAAO;YACL,oFAAoF;YACpFC,OAAO;gBAACR;aAAS;YACjBS,SAAS;gBACP;oBACEC,WAAW,kBAAM,KAACP;4BAAkBI,SAAS;;oBAC7CI,UAAU;gBACZ;aACD;YACDC,cAAc;gBACZC,QAAQ,EAAE;YACZ;YACAC,eAAe;gBACbD,QAAQ,EAAE;YACZ;QACF;IACF;IAEA,OAAO;QACLL,OAAO;YAACR;SAAS;QACjBS,SAAS;YACP;gBACEC,WAAW;oBACT,MAAM,EAAEK,IAAI,EAAE,GAAGd;oBAEjB,mCAAmC;oBACnC,MAAMe,aAAa,OAAOC,WAAW,cACjCb,yBACAc;oBAEJ,uCAAuC;oBACvC,MAAMC,cAAcJ,MAAMK,SAAS;oBAEnC,qBACE;;0CACE,KAACjB;gCAAkBI,SAAS;;0CAC5B,KAACL;gCACCiB,aAAaA;gCACbH,YAAYA;gCACZK,oBAAoBf,OAAOe;;;;gBAInC;gBACAV,UAAU;YACZ;SACD;QACDC,cAAc;YACZC,QAAQ,EAAE;QA0BZ;QACAC,eAAe;YACbD,QAAQ,EAAE;QAkBZ;IACF;AACF,GACD"}
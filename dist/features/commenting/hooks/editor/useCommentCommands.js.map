{"version":3,"sources":["../../../../../src/features/commenting/hooks/editor/useCommentCommands.ts"],"sourcesContent":["'use client'\n\nimport type { LexicalEditor, NodeKey } from '@payloadcms/richtext-lexical/lexical'\n\nimport {\n  $getSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  COMMAND_PRIORITY_LOW,\n  KEY_ESCAPE_COMMAND,\n} from '@payloadcms/richtext-lexical/lexical'\nimport { useCallback, useEffect } from 'react'\n\nimport type { CommentCommandsResult } from '../../types/hooks.js'\n\nimport { INSERT_COMMENT_COMMAND, TOGGLE_COMMENTS_COMMAND } from '../../command.js'\n\n/**\n * Hook for handling comment-related commands\n * @param editor The Lexical editor instance\n * @param setShowCommentInput Function to set whether to show the comment input\n * @param setShowComments Function to set whether to show comments\n * @param showComments Current state of showing comments\n * @param showCommentInput Current state of showing comment input\n * @param setActiveAnchorKey Function to set the active anchor key\n * @returns Object with functions to handle comment commands\n */\nexport function useCommentCommands(\n  editor: LexicalEditor,\n  setShowCommentInput: (show: boolean) => void,\n  setShowComments: (show: boolean) => void,\n  showComments: boolean,\n  showCommentInput: boolean,\n  setActiveAnchorKey: (key: NodeKey | null) => void\n): CommentCommandsResult {\n  // Cancel adding a comment\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection()\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true\n      }\n    })\n    setShowCommentInput(false)\n    // Reset the active anchor key to hide the AddCommentBox tooltip\n    setActiveAnchorKey(null)\n  }, [editor, setShowCommentInput, setActiveAnchorKey])\n\n  // Add a comment\n  const onAddComment = useCallback(() => {\n    editor.dispatchCommand(INSERT_COMMENT_COMMAND, undefined)\n  }, [editor])\n\n  // Toggle showing comments\n  const toggleComments = useCallback(() => {\n    editor.dispatchCommand(TOGGLE_COMMENTS_COMMAND, undefined)\n  }, [editor])\n\n  // Register commands\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_COMMENT_COMMAND,\n      () => {\n        setShowCommentInput(true)\n        return true\n      },\n      COMMAND_PRIORITY_CRITICAL,\n    )\n  }, [editor, setShowCommentInput])\n\n  useEffect(() => {\n    return editor.registerCommand(\n      TOGGLE_COMMENTS_COMMAND,\n      () => {\n        setShowComments(!showComments)\n        return true\n      },\n      COMMAND_PRIORITY_CRITICAL,\n    )\n  }, [editor, setShowComments, showComments])\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      () => {\n        if (showCommentInput) {\n          cancelAddComment()\n          return true\n        }\n        return false\n      },\n      COMMAND_PRIORITY_LOW,\n    )\n  }, [editor, showCommentInput, cancelAddComment])\n\n  return {\n    cancelAddComment,\n    onAddComment,\n    toggleComments,\n  }\n}\n"],"names":["$getSelection","COMMAND_PRIORITY_CRITICAL","COMMAND_PRIORITY_LOW","KEY_ESCAPE_COMMAND","useCallback","useEffect","INSERT_COMMENT_COMMAND","TOGGLE_COMMENTS_COMMAND","useCommentCommands","editor","setShowCommentInput","setShowComments","showComments","showCommentInput","setActiveAnchorKey","cancelAddComment","update","selection","dirty","onAddComment","dispatchCommand","undefined","toggleComments","registerCommand"],"mappings":"AAAA;AAIA,SACEA,aAAa,EACbC,yBAAyB,EACzBC,oBAAoB,EACpBC,kBAAkB,QACb,uCAAsC;AAC7C,SAASC,WAAW,EAAEC,SAAS,QAAQ,QAAO;AAI9C,SAASC,sBAAsB,EAAEC,uBAAuB,QAAQ,mBAAkB;AAElF;;;;;;;;;CASC,GACD,OAAO,SAASC,mBACdC,MAAqB,EACrBC,mBAA4C,EAC5CC,eAAwC,EACxCC,YAAqB,EACrBC,gBAAyB,EACzBC,kBAAiD;IAEjD,0BAA0B;IAC1B,MAAMC,mBAAmBX,YAAY;QACnCK,OAAOO,MAAM,CAAC;YACZ,MAAMC,YAAYjB;YAClB,oBAAoB;YACpB,IAAIiB,cAAc,MAAM;gBACtBA,UAAUC,KAAK,GAAG;YACpB;QACF;QACAR,oBAAoB;QACpB,gEAAgE;QAChEI,mBAAmB;IACrB,GAAG;QAACL;QAAQC;QAAqBI;KAAmB;IAEpD,gBAAgB;IAChB,MAAMK,eAAef,YAAY;QAC/BK,OAAOW,eAAe,CAACd,wBAAwBe;IACjD,GAAG;QAACZ;KAAO;IAEX,0BAA0B;IAC1B,MAAMa,iBAAiBlB,YAAY;QACjCK,OAAOW,eAAe,CAACb,yBAAyBc;IAClD,GAAG;QAACZ;KAAO;IAEX,oBAAoB;IACpBJ,UAAU;QACR,OAAOI,OAAOc,eAAe,CAC3BjB,wBACA;YACEI,oBAAoB;YACpB,OAAO;QACT,GACAT;IAEJ,GAAG;QAACQ;QAAQC;KAAoB;IAEhCL,UAAU;QACR,OAAOI,OAAOc,eAAe,CAC3BhB,yBACA;YACEI,gBAAgB,CAACC;YACjB,OAAO;QACT,GACAX;IAEJ,GAAG;QAACQ;QAAQE;QAAiBC;KAAa;IAE1CP,UAAU;QACR,OAAOI,OAAOc,eAAe,CAC3BpB,oBACA;YACE,IAAIU,kBAAkB;gBACpBE;gBACA,OAAO;YACT;YACA,OAAO;QACT,GACAb;IAEJ,GAAG;QAACO;QAAQI;QAAkBE;KAAiB;IAE/C,OAAO;QACLA;QACAI;QACAG;IACF;AACF"}
{"version":3,"sources":["../../../../../src/features/commenting/components/core/CommentPanel.tsx"],"sourcesContent":["'use client'\n\nimport React, { useEffect, useRef, useState } from 'react'\n\nimport type { Comment, Thread } from '../../types/core.js'\nimport type { CommentsPanelProps } from '../../types/props.js'\n\nimport { confirmDeleteAllComments, confirmDeleteComment, confirmDeleteThread } from '../../utils/dialog.js'\nimport { createComment } from '../../utils/factory.js'\nimport { CommentItem } from '../display/CommentItem.js'\nimport { ThreadItem } from '../display/ThreadItem.js'\n\n/**\n * Panel for displaying and managing comments and threads\n */\nexport const CommentsPanel: React.FC<CommentsPanelProps> = ({\n  activeIDs,\n  comments,\n  currentUser,\n  deleteAllComments,\n  deleteCommentOrThread,\n  markNodeMap,\n  resolveThread,\n  submitAddComment,\n}) => {\n  const listRef = useRef<HTMLUListElement>(null)\n  const [showDeleteDropdown, setShowDeleteDropdown] = useState(false)\n  const isEmpty = comments.length === 0\n\n  const handleDeleteComment = (commentId: string, thread?: Thread) => {\n    if (!confirmDeleteComment()) {return}\n    \n    // Find the comment in the thread or standalone\n    const comment = thread \n      ? thread.comments.find(c => c.id === commentId)\n      : comments.find(c => c.id === commentId && c.type === 'comment') as Comment | undefined\n    \n    if (comment) {\n      deleteCommentOrThread(comment, thread)\n    }\n  }\n\n  const handleResolveThread = (thread: Thread) => {\n    void resolveThread(thread, !thread.resolved)\n  }\n\n  const handleDeleteThread = (thread: Thread) => {\n    if (confirmDeleteThread()) {\n      deleteCommentOrThread(thread)\n    }\n  }\n\n  const handleSubmitReply = (content: string, thread: Thread) => {\n    if (content.trim()) {\n      submitAddComment(createComment(content, currentUser), false, thread)\n    }\n  }\n\n  const toggleDeleteDropdown = () => {\n    setShowDeleteDropdown(!showDeleteDropdown)\n  }\n\n  const handleDeleteAllComments = () => {\n    if (deleteAllComments && confirmDeleteAllComments()) {\n      deleteAllComments()\n      setShowDeleteDropdown(false)\n    }\n  }\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as HTMLElement\n      if (!target.closest('.CommentPlugin_CommentsPanel_DeleteContainer')) {\n        setShowDeleteDropdown(false)\n      }\n    }\n\n    document.addEventListener('click', handleClickOutside)\n    return () => {\n      document.removeEventListener('click', handleClickOutside)\n    }\n  }, [])\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <div className=\"CommentPlugin_CommentsPanel_Header\">\n        <h2 className=\"CommentPlugin_CommentsPanel_Heading\">Comments</h2>\n        {!isEmpty && deleteAllComments && (\n          <div className=\"CommentPlugin_CommentsPanel_DeleteContainer\">\n            <button\n              aria-label=\"Delete options\"\n              className=\"CommentPlugin_CommentsPanel_DeleteIcon\"\n              onClick={toggleDeleteDropdown}\n            >\n              <i className=\"delete\" />\n            </button>\n            {showDeleteDropdown && (\n              <div className=\"CommentPlugin_CommentsPanel_DeleteDropdown\">\n                <button\n                  aria-label=\"Delete all comments\"\n                  className=\"CommentPlugin_CommentsPanel_DeleteAllButton\"\n                  onClick={handleDeleteAllComments}\n                >\n                  Delete All\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">No Comments</div>\n      ) : (\n        <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n          {comments.map((commentOrThread) => {\n            const id = commentOrThread.id\n            \n            if (commentOrThread.type === 'thread') {\n              const thread = commentOrThread\n              return (\n                <ThreadItem\n                  isActive={activeIDs.includes(id)}\n                  isInteractive={markNodeMap.has(id)}\n                  key={id}\n                  onDeleteComment={(commentId) => handleDeleteComment(commentId, thread)}\n                  onDeleteThread={handleDeleteThread}\n                  onResolveThread={() => handleResolveThread(thread)}\n                  onSubmitReply={(content) => handleSubmitReply(content, thread)}\n                  thread={thread}\n                />\n              )\n            }\n            \n            // Handle standalone comments (not in a thread)\n            return (\n              <CommentItem\n                comment={commentOrThread}\n                key={id}\n                onDelete={\n                  !commentOrThread.deleted\n                    ? () => handleDeleteComment(commentOrThread.id)\n                    : undefined\n                }\n              />\n            )\n          })}\n        </ul>\n      )}\n    </div>\n  )\n}\n"],"names":["React","useEffect","useRef","useState","confirmDeleteAllComments","confirmDeleteComment","confirmDeleteThread","createComment","CommentItem","ThreadItem","CommentsPanel","activeIDs","comments","currentUser","deleteAllComments","deleteCommentOrThread","markNodeMap","resolveThread","submitAddComment","listRef","showDeleteDropdown","setShowDeleteDropdown","isEmpty","length","handleDeleteComment","commentId","thread","comment","find","c","id","type","handleResolveThread","resolved","handleDeleteThread","handleSubmitReply","content","trim","toggleDeleteDropdown","handleDeleteAllComments","handleClickOutside","event","target","closest","document","addEventListener","removeEventListener","div","className","h2","button","aria-label","onClick","i","ul","ref","map","commentOrThread","isActive","includes","isInteractive","has","onDeleteComment","onDeleteThread","onResolveThread","onSubmitReply","onDelete","deleted","undefined"],"mappings":"AAAA;;AAEA,OAAOA,SAASC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAO;AAK1D,SAASC,wBAAwB,EAAEC,oBAAoB,EAAEC,mBAAmB,QAAQ,wBAAuB;AAC3G,SAASC,aAAa,QAAQ,yBAAwB;AACtD,SAASC,WAAW,QAAQ,4BAA2B;AACvD,SAASC,UAAU,QAAQ,2BAA0B;AAErD;;CAEC,GACD,OAAO,MAAMC,gBAA8C,CAAC,EAC1DC,SAAS,EACTC,QAAQ,EACRC,WAAW,EACXC,iBAAiB,EACjBC,qBAAqB,EACrBC,WAAW,EACXC,aAAa,EACbC,gBAAgB,EACjB;IACC,MAAMC,UAAUjB,OAAyB;IACzC,MAAM,CAACkB,oBAAoBC,sBAAsB,GAAGlB,SAAS;IAC7D,MAAMmB,UAAUV,SAASW,MAAM,KAAK;IAEpC,MAAMC,sBAAsB,CAACC,WAAmBC;QAC9C,IAAI,CAACrB,wBAAwB;YAAC;QAAM;QAEpC,+CAA+C;QAC/C,MAAMsB,UAAUD,SACZA,OAAOd,QAAQ,CAACgB,IAAI,CAACC,CAAAA,IAAKA,EAAEC,EAAE,KAAKL,aACnCb,SAASgB,IAAI,CAACC,CAAAA,IAAKA,EAAEC,EAAE,KAAKL,aAAaI,EAAEE,IAAI,KAAK;QAExD,IAAIJ,SAAS;YACXZ,sBAAsBY,SAASD;QACjC;IACF;IAEA,MAAMM,sBAAsB,CAACN;QAC3B,KAAKT,cAAcS,QAAQ,CAACA,OAAOO,QAAQ;IAC7C;IAEA,MAAMC,qBAAqB,CAACR;QAC1B,IAAIpB,uBAAuB;YACzBS,sBAAsBW;QACxB;IACF;IAEA,MAAMS,oBAAoB,CAACC,SAAiBV;QAC1C,IAAIU,QAAQC,IAAI,IAAI;YAClBnB,iBAAiBX,cAAc6B,SAASvB,cAAc,OAAOa;QAC/D;IACF;IAEA,MAAMY,uBAAuB;QAC3BjB,sBAAsB,CAACD;IACzB;IAEA,MAAMmB,0BAA0B;QAC9B,IAAIzB,qBAAqBV,4BAA4B;YACnDU;YACAO,sBAAsB;QACxB;IACF;IAEA,uCAAuC;IACvCpB,UAAU;QACR,MAAMuC,qBAAqB,CAACC;YAC1B,MAAMC,SAASD,MAAMC,MAAM;YAC3B,IAAI,CAACA,OAAOC,OAAO,CAAC,iDAAiD;gBACnEtB,sBAAsB;YACxB;QACF;QAEAuB,SAASC,gBAAgB,CAAC,SAASL;QACnC,OAAO;YACLI,SAASE,mBAAmB,CAAC,SAASN;QACxC;IACF,GAAG,EAAE;IAEL,qBACE,MAACO;QAAIC,WAAU;;0BACb,MAACD;gBAAIC,WAAU;;kCACb,KAACC;wBAAGD,WAAU;kCAAsC;;oBACnD,CAAC1B,WAAWR,mCACX,MAACiC;wBAAIC,WAAU;;0CACb,KAACE;gCACCC,cAAW;gCACXH,WAAU;gCACVI,SAASd;0CAET,cAAA,KAACe;oCAAEL,WAAU;;;4BAEd5B,oCACC,KAAC2B;gCAAIC,WAAU;0CACb,cAAA,KAACE;oCACCC,cAAW;oCACXH,WAAU;oCACVI,SAASb;8CACV;;;;;;;YAQVjB,wBACC,KAACyB;gBAAIC,WAAU;0BAAoC;+BAEnD,KAACM;gBAAGN,WAAU;gBAAmCO,KAAKpC;0BACnDP,SAAS4C,GAAG,CAAC,CAACC;oBACb,MAAM3B,KAAK2B,gBAAgB3B,EAAE;oBAE7B,IAAI2B,gBAAgB1B,IAAI,KAAK,UAAU;wBACrC,MAAML,SAAS+B;wBACf,qBACE,KAAChD;4BACCiD,UAAU/C,UAAUgD,QAAQ,CAAC7B;4BAC7B8B,eAAe5C,YAAY6C,GAAG,CAAC/B;4BAE/BgC,iBAAiB,CAACrC,YAAcD,oBAAoBC,WAAWC;4BAC/DqC,gBAAgB7B;4BAChB8B,iBAAiB,IAAMhC,oBAAoBN;4BAC3CuC,eAAe,CAAC7B,UAAYD,kBAAkBC,SAASV;4BACvDA,QAAQA;2BALHI;oBAQX;oBAEA,+CAA+C;oBAC/C,qBACE,KAACtB;wBACCmB,SAAS8B;wBAETS,UACE,CAACT,gBAAgBU,OAAO,GACpB,IAAM3C,oBAAoBiC,gBAAgB3B,EAAE,IAC5CsC;uBAJDtC;gBAQX;;;;AAKV,EAAC"}